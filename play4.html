<!DOCTYPE html>
<html>
<head>
    <title>è±†è…å¥³å­©-é•·æ–¹å½¢ç‰ˆï¼ˆæ¥µé™å®Œç¾ï¼‰</title>
    <style>
        body { margin: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(#87CEEB, #98FB98); font-family: Arial, sans-serif; }
        canvas { border: 2px solid #ddd; border-radius: 10px; cursor: pointer; }
        #info { margin-top: 10px; color: #333; text-align: center; }
    </style>
</head>
<body>
    <canvas id="game" width="400" height="600"></canvas>
    <div id="info">é»æ“Šè·³èº | å¿…é ˆå®Œç¾ä¸­é–“(Â±åŠè±†è…å¯¬) | å¦å‰‡é‡å•Ÿ | æŒ‰Ré‡å•Ÿ | é•·æ–¹å½¢è±†è…å›ºå®šç§»å‹•</div>
    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        
        // éŠæˆ²ç‹€æ…‹ - é•·æ–¹å½¢è±†è…
        let gameState = {
            girl: { x: 200, y: 520, vy: 0, radius: 15, grounded: true, jumpCooldown: 0 },
            tofuStack: [{ x: 170, y: 550, w: 60, h: 30 }],  // é•·æ–¹å½¢60x30
            currentTofu: { x: 170, y: 510, w: 60, h: 30, dir: 1, speed: 1.5, minX: 140, maxX: 240 },
            score: 10,
            gameOver: false,
            cameraY: 0,
            cameraActive: false,
            keys: {}
        };

        function initGame() {
            gameState = {
                girl: { x: 200, y: 520, vy: 0, radius: 15, grounded: true, jumpCooldown: 0 },
                tofuStack: [{ x: 170, y: 550, w: 60, h: 30 }],
                currentTofu: { x: 170, y: 510, w: 60, h: 30, dir: 1, speed: 1.5, minX: 140, maxX: 240 },
                score: 10,
                gameOver: false,
                cameraY: 0,
                cameraActive: false,
                keys: {}
            };
        }

        function updateCamera() {
            const topTofu = gameState.tofuStack[gameState.tofuStack.length - 1];
            if (!gameState.cameraActive && (gameState.tofuStack.length > 8 || topTofu.y < 320)) {
                gameState.cameraActive = true;
            }
            if (gameState.cameraActive) {
                gameState.cameraY = topTofu.y - 280;
            }
        }

        function drawGirl(cameraY) {
            const g = gameState.girl;
            const screenY = g.y - cameraY;
            ctx.save();
            ctx.translate(g.x, screenY);
            ctx.fillStyle = '#ff69b4';
            ctx.beginPath();
            ctx.arc(0, -g.radius, g.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#ffc0cb';
            ctx.fillRect(-8, -g.radius + 5, 16, 20);
            ctx.restore();
        }

        function drawTofu(stack, cameraY) {
            ctx.fillStyle = '#fffacd';
            ctx.shadowColor = '#ffeb99';
            ctx.shadowBlur = 8;
            stack.forEach((t) => {
                const screenY = t.y - cameraY;
                if (screenY > -60 && screenY < 650) {
                    ctx.fillRect(t.x, screenY, t.w, t.h);
                    ctx.shadowBlur = 0;
                    ctx.strokeStyle = '#f0e68c';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(t.x, screenY, t.w, t.h);
                    // è±†è…ç´‹ç†
                    ctx.strokeStyle = '#e6d988';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(t.x + 5, screenY + 5);
                    ctx.lineTo(t.x + t.w - 5, screenY + 5);
                    ctx.stroke();
                }
            });
        }

        function drawCurrentTofu(cameraY) {
            const t = gameState.currentTofu;
            const screenY = t.y - cameraY;
            if (screenY > -60 && screenY < 650) {
                ctx.fillStyle = '#ffffff';
                ctx.shadowColor = '#f0f0f0';
                ctx.shadowBlur = 10;
                ctx.fillRect(t.x, screenY, t.w, t.h);
                ctx.shadowBlur = 0;
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 3;
                ctx.strokeRect(t.x, screenY, t.w, t.h);
                // ç§»å‹•ä¸­çš„é–ƒå…‰æ•ˆæœ
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.fillRect(t.x, screenY, t.w * 0.3, t.h);
            }
        }

        function update() {
            if (gameState.gameOver) return;
            const g = gameState.girl;
            const topTofu = gameState.tofuStack[gameState.tofuStack.length - 1];

            g.jumpCooldown = Math.max(0, g.jumpCooldown - 1);
            if (!g.grounded) {
                g.vy += 0.4;
                g.y += g.vy;
            }

            updateCamera();

            // é•·æ–¹å½¢è±†è…å›ºå®šç¯„åœç§»å‹•
            const t = gameState.currentTofu;
            t.x += t.dir * t.speed;
            if (t.x <= t.minX || t.x >= t.maxX) {
                t.dir *= -1;
                t.x = Math.max(t.minX, Math.min(t.maxX, t.x));
            }
            t.speed = Math.min(4, t.speed + 0.003);

            // ğŸš¨ æ¥µé™ç¢°æ’æª¢æ¸¬ï¼šåªæœ‰å®Œç¾ä¸­é–“æ‰æˆåŠŸï¼
            const tofuCenter = topTofu.x + topTofu.w / 2;
            const girlCenter = g.x;
            const dist = Math.abs(girlCenter - tofuCenter);
            const perfectRange = topTofu.w / 4;  // åŠå€‹è±†è…å¯¬åº¦çš„1/2 = 15åƒç´  (Â±15px)
            
            if (g.y + g.radius >= topTofu.y && 
                g.x > topTofu.x - 15 && 
                g.x < topTofu.x + topTofu.w + 15) {
                
                g.grounded = true;
                g.y = topTofu.y - g.radius * 2;
                g.vy = 0;
                
                // ğŸ”´ åªæœ‰å®Œç¾ä¸­é–“æ‰ç¹¼çºŒï¼Œå¦å‰‡éŠæˆ²çµæŸï¼
                if (dist <= perfectRange) {
                    // å®Œç¾æˆåŠŸï¼šå¾—åˆ†+å½ˆè·³
                    gameState.score += 20;
                    g.y -= 4;
                    setTimeout(() => { g.y += 4; }, 120);

                    // ç”Ÿæˆæ–°é•·æ–¹å½¢è±†è…
                    const newTofu = { x: t.x, y: topTofu.y - 35, w: 60, h: 30 };
                    gameState.tofuStack.push(newTofu);
                    t.y -= 35;
                    t.x = 170 + Math.random() * 50;
                    if (t.x > 200) t.dir = -1; else t.dir = 1;
                    g.y -= 35;
                } else {
                    // âŒ æ²’å®Œç¾ä¸­é–“ï¼šç›´æ¥éŠæˆ²çµæŸï¼
                    gameState.gameOver = true;
                }
            }

            if (g.y > gameState.tofuStack[gameState.tofuStack.length - 1].y + 80) {
                gameState.gameOver = true;
            }
        }

        function draw() {
            ctx.clearRect(0, 0, 400, 600);
            const cameraY = gameState.cameraY;
            
            const grad = ctx.createLinearGradient(0, 0, 0, 600);
            grad.addColorStop(0, '#87CEEB');
            grad.addColorStop(1, '#E0F6FF');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, 400, 600);

            drawTofu(gameState.tofuStack, cameraY);
            drawCurrentTofu(cameraY);
            drawGirl(cameraY);

            // UI
            ctx.fillStyle = '#000';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`åˆ†æ•¸: ${gameState.score}`, 20, 50);
            ctx.font = '18px Arial';
            ctx.fillStyle = gameState.cameraActive ? '#4CAF50' : '#FF9800';
            ctx.fillText(`æ”åƒæ©Ÿ: ${gameState.cameraActive ? 'å•Ÿå‹•' : 'å¾…æ©Ÿ'}`, 20, 80);
            
            if (gameState.gameOver) {
                ctx.fillStyle = 'rgba(0,0,0,0.8)';
                ctx.fillRect(0, 0, 400, 600);
                ctx.fillStyle = '#ff4444';
                ctx.font = 'bold 36px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('éŠæˆ²çµæŸ!', 200, 280);
                ctx.fillStyle = '#fff';
                ctx.font = '24px Arial';
                ctx.fillText(`æœ€çµ‚åˆ†æ•¸: ${gameState.score}`, 200, 330);
                ctx.fillText('æŒ‰ R é‡å•Ÿ', 200, 370);
                ctx.textAlign = 'left';
            }
        }

        function jump() {
            const g = gameState.girl;
            if (g.grounded && g.jumpCooldown === 0 && !gameState.gameOver) {
                g.vy = -14;
                g.grounded = false;
                g.jumpCooldown = 12;
            }
        }

        canvas.addEventListener('click', jump);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); jump(); });
        document.addEventListener('keydown', (e) => {
            if (e.key.toLowerCase() === 'r' && gameState.gameOver) {
                initGame();
            }
        });

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        gameLoop();
    </script>
</body>
</html>
